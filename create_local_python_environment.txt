## Instructions for setting up a local python environment for running and 
## editing the ELASPIC pipeline. I recommend using pyenv so that you don't 
## mess with the system python installation.

########################################################################
## Step 1: Install pyenv (and pyenv-virtualenv)

## Download pyenv into your $HOME/.pyenv directory (or any other directory)
cd
git clone git://github.com/yyuu/pyenv.git .pyenv
git clone git://github.com/yyuu/pyenv-virtualenv.git .pyenv/plugins/pyenv-virtualenv
## Add the following 4 lines to your ~/.bashrc or ~/.bash_profile file
# export PYENV_ROOT="$HOME/.pyenv
# export PATH="$PYENV_ROOT/bin:$PATH"
# eval "$(pyenv init -)"
# eval "$(pyenv virtualenv-init -)"
echo 'export PYENV_ROOT="$HOME/.pyenv"' >> ~/.bash_profile
echo 'export PATH="$PYENV_ROOT/bin:$PATH"' >> ~/.bash_profile
echo 'eval "$(pyenv init -)"' >> ~/.bash_profile
echo 'eval "$(pyenv virtualenv-init -)"' >> ~/.bash_profile
## Restart the shell
exec $SHELL
## Install python 2.7.7 in your pyenv environemnt
CONFIGURE_OPTS="--enable-unicode=ucs4 --enable-ipv6 --with-dbmliborder=gdbm:bdb --with-threads " \
MAKE_OPTS="-LLIBDIR" \
pyenv install --verbose 2.7.7
# Important!!! The above three lines should be executed together (note the '\')
# This will install python with ucs4 unicode encoding, which is required later on
# (Note to self: Removed --enable-shared option from CONFIGURE_OPTS.)


########################################################################
## Step 2: Install python packages

## Enter the elaspic home directory
cd $HOME/working/elaspic # this will depend on where you put the elaspic folder
## Make pyenv python 2.7.7 that you installed above the default python
# interpreter for this project
pyenv local 2.7.7
# (If you want a python version specific to elaspic, you can run
# "pyenv virtualenv 2.7.7 elaspic". This will create a separate python 2.7.7
# installation dedicated to this project).
## Run the following commands to install packages required for running elaspic
pip install --upgrade argparse
pip install --upgrade Cython
pip install --upgrade numpy
pip install --upgrade scipy
pip install --upgrade scikit-learn
pip install --upgrade Biopython
pip install --upgrade MySQL-python
pip install --upgrade psycopg2
pip install --upgrade SQLAlchemy
pip install --upgrade django
pip install --upgrade psutil
pip install --upgrade pandas
# These packages may be required in the future and are good to have anyway
pip install --upgrade numexpr
pip install --upgrade bottleneck
pip install --upgrade beautifulsoup4
pip install --upgrade patsy
pip install --upgrade statsmodels


########################################################################
## Step 3: Install spyder
# The procedure outlines above will allow you to run elaspic from the command 
# line (i.e. python ./code/elaspic.py). If you want to be able to edit the code 
# using spyder, follow the steps below:

# You won't be using system spyder, but the easiest way to get the dependencies 
# is using the package manager:
sudo apt-get install spyder 
# Spyder requires PySide, PyQt4 and sip, which are difficult to compile and install locally.
# Instead you can use symbolic links to the system version 
# (you will need to change the paths to point to your pyenv installation)
ln -fs /usr/lib/python2.7/dist-packages/PySide /home/alexey/.pyenv/versions/2.7.7/lib/python2.7/site-packages/PySide
ln -fs /usr/lib/python2.7/dist-packages/PyQt4 /home/alexey/.pyenv/versions/2.7.7/lib/python2.7/site-packages/PyQt4
ln -fs /usr/lib/python2.7/dist-packages/sip.so /home/alexey/.pyenv/versions/2.7.7/lib/python2.7/site-packages/sip.so
# Install packages required by spyder
pip install --upgrade matplotlib
pip install --upgrade ipython
pip install --upgrade pyzmq
pip install --upgrade tornado
pip install --upgrade matplotlib
pip install --upgrade pygments
pip install --upgrade pep8
pip install --upgrade pyflakes
pip install --upgrade rope
pip install --upgrade sphinx
pip install --upgrade sympy
# Install spyder 
# (you can choose whatever version you want from their bitbucket repository)
pip install --upgrade https://bitbucket.org/spyder-ide/spyderlib/get/v2.3.0rc.tar.gz

# Start spyder with python 2.7.7 and ipython 2 configured to use python 2.7.7
# and all the packages that we installed above
spyder # this should be executed from the elaspic home directory


